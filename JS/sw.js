(()=>{var e={500:e=>{e.exports={baseUrl:"https://smm-promo-hack.c1assic.ru",showForPages:["*://megamarket.ru/*"]}},24:(e,t,r)=>{const a=new(r(561));e.exports={getAuthToken:function(){return a.runExclusive((()=>new Promise((e=>{const t="auth_token";chrome.storage.local.get({[t]:""},(r=>{const a=r[t];e(a)}))}))))},setAuthToken:async function(e){return a.runExclusive((()=>new Promise((t=>{chrome.storage.local.set({auth_token:e},(()=>{t()}))}))))}}},561:e=>{e.exports=class{_queue=[];_isLocked=!1;acquire(){return new Promise((e=>{this._queue.push({resolve:e}),this._dispatch()}))}async runExclusive(e){const t=await this.acquire();try{return await e()}finally{t()}}_dispatch(){if(this._isLocked)return;const e=this._queue.shift();e&&(this._isLocked=!0,e.resolve(this._buildRelease()))}_buildRelease(){return()=>{this._isLocked=!1,this._dispatch()}}}}},t={};function r(a){var n=t[a];if(void 0!==n)return n.exports;var o=t[a]={exports:{}};return e[a](o,o.exports,r),o.exports}(()=>{const e=r(500),{getAuthToken:t,setAuthToken:a}=r(24);async function n(e,t){if(document.smmPromoHackScriptLoading)return alert("Скрипт уже загружается"),!1;document.smmPromoHackScriptLoading=!0;const r=await fetch(`${t}/getScript?authtoken=${e}`).then((async e=>{if(!e.ok){const t=await e.text();throw new Error(t)}return e})).then((e=>e.text())).then((e=>({data:e}))).catch((e=>({error:!0,errorMessage:e.message})));if(!r?.data||r.error)return alert("Ошибка загрузки скрипта: "+r.errorMessage),document.smmPromoHackScriptLoading=!1,!1;const a=document.createElement("script");return a.text=r.data,a.type="text/javascript",(document.head||document.body||document.documentElement).appendChild(a),document.smmPromoHackScriptLoading=!1,!0}chrome.runtime.onInstalled.addListener((async()=>{chrome.contextMenus.create({title:"Сделать несколько заказов",documentUrlPatterns:e.showForPages,id:"сontextMenuStartScanner"}),console.log("onInstalled")})),chrome.contextMenus.onClicked.addListener((async(r,o)=>{if("сontextMenuStartScanner"===r.menuItemId){let r=await t();if(r){const t=await fetch(`${e.baseUrl}/checkAuthToken?authtoken=${r}`).then((async e=>{if(!e.ok){const t=await e.text();throw new Error(t)}return e})).then((e=>e.json())).then((e=>({data:e}))).catch((e=>({error:!0,errorMessage:e.message})));t&&!t.error||(r=void 0,t.errorMessage&&await chrome.scripting.executeScript({target:{tabId:o.id,allFrames:!1},func:e=>{alert(e)},args:[t.errorMessage]}))}if(!r){const t=await fetch(`${e.baseUrl}/getAuthLink`).then((async e=>{if(!e.ok){const t=await e.text();throw new Error(t)}return e})).then((e=>e.json())).then((e=>({data:e}))).catch((e=>({error:!0,errorMessage:e.message})));return t&&!t.error&&t?.data?.url?.length&&t?.data?.authToken?.length&&t?.data?.message?.length?(r=t.data.authToken,await a(r),void await chrome.scripting.executeScript({target:{tabId:o.id,allFrames:!1},func:(e,t)=>{let r=document.createElement("a");r.target="_blank",r.href=e,window.confirm(t)&&r.click()},args:[t.data.url,t.data.message]})):void(r=void 0)}let s=await chrome.scripting.executeScript({target:{tabId:o.id,allFrames:!1},func:n,args:[r,e.baseUrl],world:"MAIN"});if(!s?.at(0)?.result)return}}))})()})();